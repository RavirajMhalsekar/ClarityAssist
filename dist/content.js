(()=>{console.log("ClarityAssist content script loaded.");let n={},t={},o=null;function e(n,t){console.log("Applying settings:",n),console.log("Applying profiles:",t);const e=(o&&o.remove(),o=document.createElement("style"),o.id="clarity-assist-styles",document.head.appendChild(o),o);let r="",l="";if(t.elderly?(document.body.style.zoom="150%",l+="contrast(120%) brightness(105%) "):t["low-vision"]?document.body.style.zoom="175%":document.body.style.zoom="100%",n.invertColors&&(l+="invert(1) "),t["color-blind"]){switch(n.colorDeficiencyType){case"protanopia":l+="sepia(20%) hue-rotate(330deg) ",r+='\n          html {\n            --color-blind-red: #FF8C8C;\n            --color-blind-green: #B4D98C;\n          }\n          html [style*="color: red"],\n          html [style*="background: red"],\n          html [style*="background-color: red"] {\n            color: var(--color-blind-red) !important;\n            background-color: var(--color-blind-red) !important;\n          }\n          html [style*="color: green"],\n          html [style*="background: green"],\n          html [style*="background-color: green"] {\n            color: var(--color-blind-green) !important;\n            background-color: var(--color-blind-green) !important;\n          }\n        ';break;case"deuteranopia":l+="sepia(20%) hue-rotate(30deg) ",r+='\n          html {\n            --color-blind-green: #D4E576;\n            --color-blind-red: #FF9E9E;\n          }\n          html [style*="color: green"],\n          html [style*="background: green"],\n          html [style*="background-color: green"] {\n            color: var(--color-blind-green) !important;\n            background-color: var(--color-blind-green) !important;\n          }\n          html [style*="color: red"],\n          html [style*="background: red"],\n          html [style*="background-color: red"] {\n            color: var(--color-blind-red) !important;\n            background-color: var(--color-blind-red) !important;\n          }\n        ';break;case"tritanopia":l+="sepia(20%) hue-rotate(200deg) ",r+='\n          html {\n            --color-blind-blue: #99CCFF;\n            --color-blind-yellow: #FFEB99;\n          }\n          html [style*="color: blue"],\n          html [style*="background: blue"],\n          html [style*="background-color: blue"] {\n            color: var(--color-blind-blue) !important;\n            background-color: var(--color-blind-blue) !important;\n          }\n          html [style*="color: yellow"],\n          html [style*="background: yellow"],\n          html [style*="background-color: yellow"] {\n            color: var(--color-blind-yellow) !important;\n            background-color: var(--color-blind-yellow) !important;\n          }\n        '}r+='\n      html {\n        /* Enhanced color contrast for common UI elements */\n        --cb-link-color: #0077CC;\n        --cb-button-bg: #2B5BA1;\n        --cb-button-text: #FFFFFF;\n        --cb-error: #CC4444;\n        --cb-success: #44AA44;\n        --cb-warning: #FF9900;\n      }\n\n      /* Apply enhanced colors to common elements */\n      html a {\n        color: var(--cb-link-color) !important;\n      }\n\n      html button:not([class*="clarity-"]),\n      html input[type="submit"],\n      html input[type="button"] {\n        background-color: var(--cb-button-bg) !important;\n        color: var(--cb-button-text) !important;\n        border: 2px solid var(--cb-button-text) !important;\n      }\n\n      /* Enhanced error/success/warning colors */\n      html [class*="error"],\n      html [class*="danger"] {\n        color: var(--cb-error) !important;\n      }\n\n      html [class*="success"] {\n        color: var(--cb-success) !important;\n      }\n\n      html [class*="warning"] {\n        color: var(--cb-warning) !important;\n      }\n\n      /* Improve text contrast */\n      html {\n        --text-main: #000000;\n        --text-secondary: #333333;\n        --background-main: #FFFFFF;\n        --background-secondary: #F5F5F5;\n      }\n\n      html body,\n      html p,\n      html h1,\n      html h2,\n      html h3,\n      html h4,\n      html h5,\n      html h6 {\n        color: var(--text-main) !important;\n      }\n\n      html body {\n        background-color: var(--background-main) !important;\n      }\n    '}if(void 0!==n.colorSaturation&&(l+=`saturate(${n.colorSaturation}%) `),void 0!==n.contrastValue&&(l+=`contrast(${n.contrastValue}%) `),e.textContent=`\n    /* Root level filters */\n    html {\n      ${l?`filter: ${l.trim()} !important;`:""}\n    }\n\n    /* Dark mode overrides */\n    ${r}\n  `,t["color-blind"]){let n=document.querySelector("#clarity-color-filters");n||(n=document.createElement("div"),n.id="clarity-color-filters",n.innerHTML='\n        <svg style="display:none">\n          <defs>\n            <filter id="protanopia-filter">\n              <feColorMatrix\n                in="SourceGraphic"\n                type="matrix"\n                values="0.567, 0.433, 0,     0, 0\n                        0.558, 0.442, 0,     0, 0\n                        0,     0.242, 0.758, 0, 0\n                        0,     0,     0,     1, 0"/>\n            </filter>\n            <filter id="deuteranopia-filter">\n              <feColorMatrix\n                in="SourceGraphic"\n                type="matrix"\n                values="0.625, 0.375, 0,   0, 0\n                        0.7,   0.3,   0,   0, 0\n                        0,     0.3,   0.7, 0, 0\n                        0,     0,     0,   1, 0"/>\n            </filter>\n            <filter id="tritanopia-filter">\n              <feColorMatrix\n                in="SourceGraphic"\n                type="matrix"\n                values="0.95, 0.05,  0,     0, 0\n                        0,    0.433, 0.567, 0, 0\n                        0,    0.475, 0.525, 0, 0\n                        0,    0,     0,     1, 0"/>\n            </filter>\n          </defs>\n        </svg>\n      ',document.body.appendChild(n))}else{const n=document.querySelector("#clarity-color-filters");n&&n.remove()}if(t["reading-guide"]){let n=document.querySelector(".clarity-reading-guide");n||(n=document.createElement("div"),n.className="clarity-reading-guide",document.body.appendChild(n),document.addEventListener("mousemove",(t=>{n.style.top=t.clientY-15+"px"})))}else{const n=document.querySelector(".clarity-reading-guide");n&&n.remove()}if(t.translate){let n=document.querySelector(".clarity-translate-btn");n||(n=document.createElement("button"),n.className="clarity-translate-btn",n.textContent="Translate",n.addEventListener("click",(()=>{const n=window.getSelection().toString();n&&window.open(`https://translate.google.com/?text=${encodeURIComponent(n)}`,"_blank")})),document.body.appendChild(n))}else{const n=document.querySelector(".clarity-translate-btn");n&&n.remove()}}chrome.storage.sync.get(["clarityAssistSettings","clarityAssistEnabledProfiles"],(o=>{n=o.clarityAssistSettings||{fontSize:100,letterSpacing:0,wordSpacing:0,lineSpacing:100,colorSaturation:100,contrastValue:100,invertColors:!1,websiteDarkMode:!1,colorDeficiencyType:null},t=o.clarityAssistEnabledProfiles||{},e(n,t)})),chrome.runtime.onMessage.addListener(((o,r,l)=>"PING"===o.type?(l({status:"ok"}),!0):("SETTINGS_UPDATED"===o.type&&(n=o.settings||n,t=o.profiles||t,e(n,t),l({status:"Settings applied successfully"})),!0)))})();