(()=>{console.log("ClarityAssist content script loaded.");let n={},t={},e=null;function o(n,t){console.log("Applying settings:",n),console.log("Applying profiles:",t);const o=(e&&e.remove(),e=document.createElement("style"),e.id="clarity-assist-styles",document.head.appendChild(e),e);let i="",r="";if(n.invertColors?r+="invert(1) ":n.websiteDarkMode&&(i+="\n      html {\n        background-color: #1a1a1a !important;\n      }\n      html body,\n      html div,\n      html section,\n      html article,\n      html aside,\n      html nav,\n      html header,\n      html footer,\n      html main {\n        background-color: #1a1a1a !important;\n        color: #ffffff !important;\n      }\n      html a {\n        color: #66b3ff !important;\n      }\n      html input,\n      html textarea,\n      html select {\n        background-color: #333333 !important;\n        color: #ffffff !important;\n        border-color: #666666 !important;\n      }\n      html button {\n        background-color: #333333 !important;\n        color: #ffffff !important;\n        border: 1px solid #666666 !important;\n      }\n    "),void 0!==n.colorSaturation&&(r+=`saturate(${n.colorSaturation}%) `),void 0!==n.contrastValue&&(r+=`contrast(${n.contrastValue}%) `),o.textContent=`\n    /* Root level filters */\n    html {\n      ${r?`filter: ${r.trim()} !important;`:""}\n    }\n\n    /* Text adjustments - apply to all text elements */\n    html body,\n    html button,\n    html input,\n    html select,\n    html textarea,\n    html a,\n    html p,\n    html span,\n    html div,\n    html h1,\n    html h2,\n    html h3,\n    html h4,\n    html h5,\n    html h6,\n    html li,\n    html td,\n    html th,\n    html label {\n      font-size: ${n.fontSize}% !important;\n      letter-spacing: ${n.letterSpacing}px !important;\n      word-spacing: ${n.wordSpacing}px !important;\n      line-height: ${n.lineSpacing/100} !important;\n    }\n\n    /* Profile-specific styles */\n    ${t.dyslexia?"\n      @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600&display=swap');\n      html * {\n        font-family: 'Lexend', sans-serif !important;\n        line-height: 1.5 !important;\n        letter-spacing: 0.5px !important;\n        word-spacing: 3px !important;\n      }\n      html p {\n        max-width: 80ch !important;\n      }\n    ":""}\n\n    ${t["reading-guide"]?"\n      .clarity-reading-guide {\n        position: fixed;\n        left: 0;\n        right: 0;\n        height: 30px;\n        background: rgba(255, 255, 0, 0.1);\n        pointer-events: none;\n        z-index: 999999;\n        border-top: 1px solid rgba(0, 0, 0, 0.1);\n        border-bottom: 1px solid rgba(0, 0, 0, 0.1);\n      }\n    ":""}\n\n    ${t["readable-font"]?"\n      html * {\n        font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif !important;\n        line-height: 1.6 !important;\n      }\n      html p, html li {\n        font-size: 18px !important;\n        max-width: 70ch !important;\n      }\n    ":""}\n\n    ${t["keyboard-nav"]?'\n      html *:focus {\n        outline: 3px solid #0066cc !important;\n        outline-offset: 2px !important;\n      }\n      html button,\n      html a,\n      html input,\n      html select,\n      html [role="button"] {\n        cursor: pointer !important;\n      }\n      html [data-focus-visible] {\n        box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.5) !important;\n      }\n    ':""}\n\n    ${t.translate?"\n      .clarity-translate-btn {\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: #0066cc;\n        color: white;\n        border: none;\n        border-radius: 4px;\n        padding: 8px 16px;\n        font-size: 14px;\n        cursor: pointer;\n        z-index: 999999;\n      }\n    ":""}\n\n    ${t["color-blind"]?`\n      html {\n        filter: ${r} \n          ${"protanopia"===n.colorDeficiencyType?"url(#protanopia-filter)":"deuteranopia"===n.colorDeficiencyType?"url(#deuteranopia-filter)":"tritanopia"===n.colorDeficiencyType?"url(#tritanopia-filter)":""} !important;\n      }\n      html [role="img"],\n      html [role="graphics-symbol"] {\n        border: 1px solid currentColor !important;\n      }\n      html [data-color-primitive] {\n        border: 1px solid currentColor !important;\n        position: relative !important;\n      }\n      html [data-color-primitive]::after {\n        content: attr(data-color-primitive);\n        position: absolute;\n        bottom: 100%;\n        left: 50%;\n        transform: translateX(-50%);\n        background: #000;\n        color: #fff;\n        padding: 2px 4px;\n        border-radius: 2px;\n        font-size: 12px;\n        white-space: nowrap;\n        display: none;\n      }\n      html [data-color-primitive]:hover::after {\n        display: block;\n      }\n    `:""}\n\n    /* Dark mode overrides */\n    ${i}\n  `,t["color-blind"]){let n=document.querySelector("#clarity-color-filters");n||(n=document.createElement("div"),n.id="clarity-color-filters",n.innerHTML='\n        <svg style="display:none">\n          <defs>\n            <filter id="protanopia-filter">\n              <feColorMatrix\n                in="SourceGraphic"\n                type="matrix"\n                values="0.567, 0.433, 0,     0, 0\n                        0.558, 0.442, 0,     0, 0\n                        0,     0.242, 0.758, 0, 0\n                        0,     0,     0,     1, 0"/>\n            </filter>\n            <filter id="deuteranopia-filter">\n              <feColorMatrix\n                in="SourceGraphic"\n                type="matrix"\n                values="0.625, 0.375, 0,   0, 0\n                        0.7,   0.3,   0,   0, 0\n                        0,     0.3,   0.7, 0, 0\n                        0,     0,     0,   1, 0"/>\n            </filter>\n            <filter id="tritanopia-filter">\n              <feColorMatrix\n                in="SourceGraphic"\n                type="matrix"\n                values="0.95, 0.05,  0,     0, 0\n                        0,    0.433, 0.567, 0, 0\n                        0,    0.475, 0.525, 0, 0\n                        0,    0,     0,     1, 0"/>\n            </filter>\n          </defs>\n        </svg>\n      ',document.body.appendChild(n))}else{const n=document.querySelector("#clarity-color-filters");n&&n.remove()}if(t["reading-guide"]){let n=document.querySelector(".clarity-reading-guide");n||(n=document.createElement("div"),n.className="clarity-reading-guide",document.body.appendChild(n),document.addEventListener("mousemove",(t=>{n.style.top=t.clientY-15+"px"})))}else{const n=document.querySelector(".clarity-reading-guide");n&&n.remove()}if(t.translate){let n=document.querySelector(".clarity-translate-btn");n||(n=document.createElement("button"),n.className="clarity-translate-btn",n.textContent="Translate",n.addEventListener("click",(()=>{const n=window.getSelection().toString();n&&window.open(`https://translate.google.com/?text=${encodeURIComponent(n)}`,"_blank")})),document.body.appendChild(n))}else{const n=document.querySelector(".clarity-translate-btn");n&&n.remove()}}chrome.storage.sync.get(["clarityAssistSettings","clarityAssistEnabledProfiles"],(e=>{n=e.clarityAssistSettings||{fontSize:100,letterSpacing:0,wordSpacing:0,lineSpacing:100,colorSaturation:100,contrastValue:100,invertColors:!1,websiteDarkMode:!1,colorDeficiencyType:null},t=e.clarityAssistEnabledProfiles||{},o(n,t)})),chrome.runtime.onMessage.addListener(((e,i,r)=>"PING"===e.type?(r({status:"ok"}),!0):("SETTINGS_UPDATED"===e.type&&(n=e.settings||n,t=e.profiles||t,o(n,t),r({status:"Settings applied successfully"})),!0)))})();